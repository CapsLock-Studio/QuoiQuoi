<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
</head>
<body>
<p>
  <strong><%= t('mailer.dear') %>: </strong><br/>
  <%= t('mailer.thanks_for_order', link: link_to(t('control_panel'), order_path(@order))).html_safe %><br/>
  <%= order_url(@order) %><br/>
  <%= t('mailer.elector') %>
</p>
<hr>
<%= t('order.no_s') %>&nbsp;P<%= @order.id %>
<h4><%= t('product_information') %></h4>
<% if @order.order_products.length > 0 %>
  <h4><%= t('products') %></h4>
  <table>
    <thead>
    <tr>
      <th></th>
      <th>
        <%= t('call_name') %>
      </th>
      <th>
        <%= t('price') %>
      </th>
      <th>
        <%= t('quantity') %>
      </th>
    </tr>
    </thead>
    <tbody>
    <% @order.order_products.each_with_index do |order_product, index| %>
      <% translate = order_product.product.product_translates.where(locale_id: @order.locale_id).first %>
      <tr>
        <td>
          <%= image_tag "http://quoiquoi.tw#{order_product.product.image.url(:thumb)}", class: 'img-responsive' %>
        </td>
        <td>
          <h5>
            <%= translate.name %><br/>
            <small><%= order_product.product_option.content if order_product.product_option %></small>
          </h5>
        </td>
        <td>
          <%= number_to_currency(order_product.price) %>
        </td>
        <td style="text-align: center">
          <%= order_product.quantity %>
        </td>
      </tr>
    <% end %>
    </tbody>
  </table>
<% end %>
<% workdays = 0 %>
<% if @order.order_custom_items.length > 0 %>
  <h4><%= t('personalized_products') %></h4>
  <table>
    <thead>
    <tr>
      <th></th>
      <th>
        <%= t('call_name') %>
      </th>
      <th>
        <%= t('price') %>
      </th>
      <th>
        <%= t('quantity') %>
      </th>
    </tr>
    </thead>
    <tbody>
    <% @order.order_custom_items.each_with_index do |order_custom_item, index| %>
    <% workdays += order_custom_item.workday %>
      <tr>
        <td>
          <%= custom_item_image_helper(order_custom_item) %>
        </td>
        <td>
          <h5>
            <%= custom_item_name_helper(order_custom_item, @order.locale_id) %>
          </h5>
        </td>
        <td>
          <%= number_to_currency(order_custom_item.order_custom_item_translates.where(locale_id: @order.locale_id).first.price) %>
        </td>
        <td style="text-align: center">
          1
        </td>
      </tr>
    <% end %>
    </tbody>
  </table>
<% end %>
<% workdays = 5 if workdays < 5 %>
<h4><%= t('shipping_fee') %>&nbsp;<label><%= number_to_currency(@fee) %></label></h4>
<% if @discount > 0 %>
  <h4><%= t('user_gift.discount') %><label>&nbsp;<%= number_to_currency(@discount) %></label></h4>
<% end %>
<h3><%= t('total_amount') %> <%= number_to_currency(@order.subtotal) %>&nbsp;<%= @order.currency %></h3>
<br/>
<% if @discount > 0 %>
  <h4><%= t('user_gift.information') %></h4>
  <table>
    <tr>
      <th></th>
      <th>
        <%= t('call_name') %>
      </th>
      <th>
        <%= t('price') %>
      </th>
      <th>
        <%= t('used_time') %>
      </th>
      <th>
        <%= t('user_gift.serial') %>
      </th>
    </tr>
    <% @user_gift_serials.each do |user_gift_serial| %>
      <% translate = user_gift_serial.user_gift.gift.gift_translates.where(locale_id: @order.locale_id).first %>
      <tr>
        <td>
          <%= image_tag "http://quoiquoi.tw#{user_gift_serial.user_gift.gift.image.url(:thumb)}" %>
        </td>
        <td>
          <%= translate.name %>
        </td>
        <td>
          <%= number_to_currency(translate.quota) %>
        </td>
        <td>
          <%= user_gift_serial.used_time.strftime('%Y/%m/%d') %>
        </td>
        <td>
          <%= user_gift_serial.serial %>
        </td>
      </tr>
    <% end %>
  </table>
<% end %>
<% if @order.payment.amount != 0 %>
  <h4><%= t('payment_information') %></h4>
  <table>
    <tr>
      <th>
        <%= t('mean') %>
      </th>
      <th>
        <%= t('time') %>
      </th>
      <th>
        <%= t('amount') %>
      </th>
    </tr>
    <tr>
      <td>
        <% if @order.payment.wait? %>
          <%= t('remittance') %>
        <% else %>
          Paypal
        <% end %>
      </td>
      <td>
        <%= @order.payment.pay_time.strftime('%Y/%m/%d') %>
      </td>
      <td>
        <%= number_to_currency(@order.payment.amount) %>
      </td>
    </tr>
  </table>
<% end %>
<h4><%= t('shipping_information') %></h4>
<table>
  <tr>
    <td style="text-align: right"><%= t('recipient_name') %></td>
    <td><%= @order.name %></td>
  </tr>
  <tr>
    <td style="text-align: right"><%= t('zip_code') %></td>
    <td><%= @order.zip_code %></td>
  </tr>
  <tr>
    <td style="text-align: right"><%= t('area') %></td>
    <td><%= @order.shipping_fee.area %></td>
  </tr>
  <tr>
    <td style="text-align: right"><%= t('address') %></td>
    <td><%= @order.address %></td>
  </tr>
  <tr>
    <td style="text-align: right"><%= t('phone_number') %></td>
    <td><%= (@order.phone.blank?)? @order.phone.gsub(/\d{4}$/, '****') : '-' %></td>
  </tr>
  <tr>
    <td style="text-align: right"><%= t('shipping_fee') %></td>
    <td><%= number_to_currency(@fee) %></td>
  </tr>
</table>
<p>
  <%= t('quoiquoi') %><br/>
  <%= t('quoiquoi_address') %><br/>
  <%= t('quoiquoi_phone') %>
</p>
<hr>
<p>
  <%= t('working_days', workdays: workdays) %><br/>
  <%= t('completed_hint').html_safe %><br/>
  <%= t('mailer.suggestion_hint') %><a href="mailto:quoiquoistudio@gmail.com">Email</a>&nbsp;-&nbsp;quoiquoistudio@gmail.com<br/>
  <%= t('sincerely') %>
</p>
<br>
<a href="http://quoiquoi.tw">quoiquoi 布知道</a>
</body>
</html>
