<%= render 'layouts/breadcrumbs' %>
<div class="container main-container">
  <div class="row row-offcanvas row-offcanvas-left">
    <%= render 'side_navigation' %>
    <div class="col-sm-9 col-xs-12">
      <div class="row margin-bottom-60">
        <%= render 'layouts/nav_item' %>
        <% @course.course_translates.where(locale_id: session[:locale_id]).each do |course_translate| %>
          <div class="col-sm-6 col-xs-12">
            <div class="row">
              <div class="col-xs-12 nopadding">
                <div class="well-sm" style="margin-top:0;padding-top:0;">
                  <a class="mediumnail fancybox-button zoomer" data-rel="fancybox-button" title="<%= course_translate.name %>" href="<%= asset_path @course.image.url(:large) %>">
                  <span class="overlay-zoom">
                    <%= image_tag @course.image.url(:medium), class: 'img-responsive' %>
                    <div class="zoom-icon"></div>
                  </span>
                  </a>
                </div>
              </div>

              <a href="#" class="col-xs-4 nopadding"
                 data-toggle="preview-change"
                 data-large="<%= asset_path @course.image.url(:large) %>"
                 data-medium="<%= asset_path @course.image.url(:medium) %>">
                <div class="well-sm">
                  <%= image_tag @course.image.url(:thumb), class: 'img-responsive' %>
                </div>
              </a>
              <% @course.course_images.each do |course_image| %>
                <a href="#" class="col-xs-4 nopadding"
                   data-toggle="preview-change"
                   data-large="<%= asset_path course_image.image.url(:large) %>"
                   data-medium="<%= asset_path course_image.image.url(:medium) %>">
                  <div class="well-sm">
                    <%= image_tag course_image.image.url(:thumb), class: 'img-responsive' %>
                  </div>
                </a>
              <% end %>
            </div>
          </div>
          <div class="col-sm-6 col-xs-12">
            <div class="row">
              <div class="col-md-12 margin-bottom-50">
                <ul class="social-icons pull-right">
                  <li><a href="#" data-original-title="Facebook" class="social_facebook"></a></li>
                  <li><a href="#" data-original-title="Twitter" class="social_twitter"></a></li>
                  <li><a href="#" data-original-title="Google Plus" class="social_googleplus"></a></li>
                </ul>
                <h3 style="color:#666;">
                  <strong>
                    <%= course_translate.name %>
                  </strong>
                </h3>
                <ul class="list-unstyled">
                  <li>
                    <span><%= t('course_time') %></span>:&nbsp;<strong><%= "#{@course.time.strftime('%Y/%m/%d %H:%M')} - #{(@course.time + @course.length.hours).strftime('%H:%M')}" %></strong>
                  </li>
                  <li>
                    <span><%= t('teacher') %></span>:&nbsp;<strong><%= course_translate.teacher %></strong>
                  </li>
                </ul>
                <%= simple_format(course_translate.description) %>
              </div>
              <div class="col-md-12">
                <h4 class="margin-bottom-20">
                  <strong style="color:#666;"><%= "#{t('money_name')}#{number_to_currency(@course.price)}" %></strong>
                  <small><%= course_translate.note %></small>
                </h4>
                <% if @course.time > Time.now + 5.hours %>
                  <% if @course.popular <= @course.registrations.collect{|registration| (registration.payment && registration.payment.completed?)? registration.attendance : 0}.inject{|sum, attendance| sum + attendance} %>
                    <a href="#" class="btn btn-default btn-lg btn-block hover-effect" disabled="disabled">
                      <span><%= t('registration.full') %></span>
                    </a>
                  <% elsif current_user && @registration.id %>
                    <%= link_to registrations_path, class: 'btn btn-default btn-lg btn-block hover-effect one-page-btn' do %>
                      <span><%= t('had_registered') %></span>
                    <% end %>
                  <% else %>
                    <%= link_to new_registration_path(course_id: @course.id), class: 'btn btn-default btn-lg btn-block hover-effect one-page-btn' do %>
                      <i class="icon-edit"></i>
                      <span><%= t('register') %></span>
                    <% end %>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <div class="row">
        <div class="col-md-12">
          <!-- Recent Works -->
          <div class="headline">
            <h2><%= t('recent_course') %></h2>
          </div>
          <div class="margin-bottom-40">
            <ul id="list" class="bxslider">
              <% @recent_courses.each do |recent_course| %>
                <li>
                  <%= link_to course_path(recent_course, month: recent_course.time.strftime('%m').to_i) do %>
                    <em class="overflow-hidden">
                      <%= image_tag recent_course.image.url(:small), style: 'width:100%;' %>
                    </em>
                    <span>
                      <% recent_course.course_translates.where(locale_id: session[:locale_id]).each do |translate| %>
                        <h5><strong><%= translate.name %></strong></h5>
                        <h5><%= "#{recent_course.time.strftime('%Y/%m/%d %H:%M')} - #{(recent_course.time + recent_course.length.hours).strftime('%Y/%m/%d %H:%M')}" %></h5>
                        <i><%= t('teacher') %>:&nbsp;<%= translate.teacher %></i>
                      <% end %>
                    </span>
                  <% end %>
                </li>
              <% end %>
            </ul>
          </div><!--/row-->
          <!-- End Recent Works -->
        </div>
      </div>
    </div>
  </div>
</div>